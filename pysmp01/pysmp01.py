# -*- coding: utf-8 -*-
import pygame
import pygame.mixer
import time
from pygame.locals import *
import sys

#----------------------------------------------------------
# ï¿½Oï¿½ï¿½ï¿½[ï¿½oï¿½ï¿½ï¿½fï¿½[ï¿½^
(GMX,GMY) = (400,400)   # ï¿½ï¿½ÊƒTï¿½Cï¿½Y
screen = pygame.display.set_mode((GMX, GMY))    # ï¿½wï¿½ï¿½Tï¿½Cï¿½Yï¿½Ì‰ï¿½Ê‚ğ¶ï¿½

# MAPï¿½fï¿½[ï¿½^
map = [[1,2,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
       [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
       [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
       [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
       [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
       [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
       [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
       [1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,3,3,3,3,3,1,1,1,1,1],
       [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
       [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
       [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
       [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
       [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
       [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
       [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
       [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
       [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
       [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
       [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
       [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
       [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
       [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
       [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
       [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
       [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,3]]

#----------------------------------------------------------
pygame.mixer.init(44100)    # BGMï¿½ï¿½ï¿½ï¿½ï¿½İ’ï¿½

# ï¿½È‚ï¿½ï¿½ï¿½ï¿½[ï¿½vï¿½Äï¿½ï¿½ï¿½ï¿½ï¿½
#IN : ï¿½tï¿½@ï¿½Cï¿½ï¿½ï¿½ï¿½
def BGM_Play(fname):     # wav,mp3,ogg
    pygame.mixer.music.load(fname)     # ï¿½ï¿½ï¿½yï¿½tï¿½@ï¿½Cï¿½ï¿½ï¿½Ì“Ç‚İï¿½ï¿½ï¿½
    pygame.mixer.music.play(-1)             # ï¿½ï¿½ï¿½yï¿½ÌÄï¿½ï¿½ï¿½(-1=ï¿½ï¿½ï¿½[ï¿½v)

# ï¿½È‚ï¿½ï¿½Iï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
def BGM_Stop():
    pygame.mixer.music.stop()               # ï¿½Äï¿½ï¿½ÌIï¿½ï¿½

#----------------------------------------------------------
# SEï¿½pï¿½Ì—Ìˆï¿½
se_list = [0]*16  # ï¿½ï¿½Ì—Ìˆï¿½ï¿½ï¿½ì¬

# SEï¿½ï¿½ï¿½ï¿½ï¿½[ï¿½h
#IN : ï¿½tï¿½@ï¿½Cï¿½ï¿½ï¿½ï¿½, SEï¿½Ôï¿½
def SE_Load(fname,no):
    se_list[no] = pygame.mixer.Sound(fname)

# SEï¿½ï¿½ï¿½Äï¿½
def SE_Play(no):
    se_list[no].play()  # ï¿½Tï¿½Eï¿½ï¿½ï¿½hï¿½ï¿½ï¿½Äï¿½

#----------------------------------------------------------
# ï¿½æ‘œï¿½pï¿½Ì—Ìˆï¿½
grp = [0]*32  # ï¿½ï¿½Ì—Ìˆï¿½ï¿½ï¿½ì¬

# ï¿½æ‘œï¿½ï¿½ï¿½ï¿½ï¿½[ï¿½h
def GRP_Load(fname,no):
    grp[no] = pygame.image.load(fname).convert_alpha()

# ï¿½æ‘œï¿½ï¿½`ï¿½ï¿½
#IN : ï¿½ï¿½ï¿½W, ï¿½æ‘œï¿½Ôï¿½
def GRP_Draw(x,y,no):
    screen.blit(grp[no], (x,y))       # ï¿½Gï¿½ï¿½`ï¿½ï¿½

#----------------------------------------------------------
# ï¿½ï¿½ï¿½Cï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
def main():
    pygame.init()                                   # Pygameï¿½Ìï¿½ï¿½ï¿½ï¿½ï¿½
    global GMX, GMY, screen, map
    (x,y) = (GMX/2, GMY/2)  # ï¿½Lï¿½ï¿½ï¿½ï¿½ï¿½Ê’u
    pygame.display.set_caption("pysmp")             # ï¿½^ï¿½Cï¿½gï¿½ï¿½ï¿½oï¿½[ï¿½É•\ï¿½ï¿½ï¿½ï¿½ï¿½é•¶ï¿½ï¿½
    font = pygame.font.Font(None, 24)               # ï¿½tï¿½Hï¿½ï¿½ï¿½gï¿½Ìİ’ï¿½(ï¿½Tï¿½Cï¿½Ypx)
    pygame.mixer.set_num_channels(8)                # SEï¿½Ìƒ`ï¿½ï¿½ï¿½ï¿½ï¿½lï¿½ï¿½ï¿½ï¿½ï¿½ï¿½İ’ï¿½

    # BGM PLAY
    #BGM_Play("pysmp01/bgm.ogg")

    # SE LOAD
    SE_Load("se01.wav", 1)
    SE_Load("se02.wav", 2)

    # ï¿½Lï¿½ï¿½ï¿½ï¿½ï¿½G LOAD
    GRP_Load("chrA07.png", 0)

    # BGï¿½G LOAD
    GRP_Load("bg01.png", 1)
    GRP_Load("bg02.png", 2)
    GRP_Load("bg03.png", 3)

    #----------------------------------------------------------
    # ï¿½Qï¿½[ï¿½ï¿½ï¿½ï¿½ï¿½[ï¿½v
    while (1):
        # ï¿½Lï¿½[ï¿½Cï¿½xï¿½ï¿½ï¿½gï¿½ï¿½ï¿½ï¿½(ï¿½Lï¿½ï¿½ï¿½ï¿½ï¿½Nï¿½^ï¿½æ‘œï¿½ÌˆÚ“ï¿½)
        pressed_key = pygame.key.get_pressed()
        if pressed_key[K_LEFT]:
            x -= 8
            SE_Play(1)
        if pressed_key[K_RIGHT]:
            x += 8
            SE_Play(1)
        if pressed_key[K_UP]:
            y -= 8
            SE_Play(1)
        if pressed_key[K_DOWN]:
            y += 8
            SE_Play(1)
        # ï¿½Lï¿½ï¿½ï¿½ï¿½ï¿½Ìï¿½ï¿½Wï¿½ï¿½ï¿½ï¿½Ê‚Ì”ÍˆÍŠOï¿½É‚ï¿½ï¿½ï¿½ê‡ï¿½Aï¿½ÍˆÍ“ï¿½ï¿½É“ï¿½ï¿½ï¿½ï¿½
        if x < 0:
            x = 0
        if x > GMX:
            x = GMX
        if y < 0:
            y = 0
        if y > GMY:
            y = GMY

        screen.fill((0,0,0))        # ï¿½ï¿½Ê‚ï¿½ï¿½ï¿½ï¿½F(#000000)ï¿½É“hï¿½ï¿½Â‚Ô‚ï¿½

        # ï¿½wï¿½iï¿½`ï¿½ï¿½
        (mx, my) = (GMX/16, GMY/16) # 1ï¿½ï¿½Ê“ï¿½ï¿½ï¿½TIPï¿½ï¿½
        yy = 0
        while (yy<my):
            xx = 0
            while (xx<mx):
                if map[yy][xx] == 3:  # ï¿½ï¿½Qï¿½ï¿½ï¿½H
                    GRP_Draw(xx*16, yy*16, 1)    # ï¿½ï¿½ï¿½nï¿½ï¿½`ï¿½ï¿½
                GRP_Draw(xx*16, yy*16, map[yy][xx])
                xx += 1
            yy += 1

        # ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½`ï¿½ï¿½
        text = font.render("MAP DRAW TEST", True, (255,245,155))   # ï¿½`ï¿½æ‚·ï¿½é•¶ï¿½ï¿½ï¿½ï¿½Ìİ’ï¿½
        screen.blit(text, [10, 10]) # ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ì•\ï¿½ï¿½ï¿½Ê’u

        # ï¿½Lï¿½ï¿½ï¿½ï¿½ï¿½ï¿½`ï¿½ï¿½
        GRP_Draw(x,y,0)

        #--------------------------------------
        pygame.display.update()     # ï¿½ï¿½Ê‚ï¿½ï¿½Xï¿½V
        pygame.time.wait(30)        # ï¿½Xï¿½Vï¿½ï¿½ï¿½ÔŠÔŠu
        # ï¿½Cï¿½xï¿½ï¿½ï¿½gï¿½ï¿½ï¿½ï¿½
        for event in pygame.event.get():
            if event.type == QUIT:  # ï¿½Â‚ï¿½ï¿½ï¿½{ï¿½^ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ê‚½ï¿½ï¿½Iï¿½ï¿½
                pygame.quit()       # Pygameï¿½ÌIï¿½ï¿½(ï¿½ï¿½Ê•Â‚ï¿½ï¿½ï¿½ï¿½ï¿½)
                sys.exit()
            # ï¿½Lï¿½[ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Æ‚ï¿½
            if event.type == KEYDOWN:
                # ESCï¿½Lï¿½[ï¿½È‚ï¿½Iï¿½ï¿½
                if event.key == K_ESCAPE:
                    pygame.quit()
                    sys.exit()

#----------------------------------------------------------
# ï¿½Qï¿½[ï¿½ï¿½ï¿½Jï¿½nï¿½ï¿½ï¿½ï¿½
if __name__ == "__main__":
    main()
